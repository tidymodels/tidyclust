<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hierarchical Clustering • tidyclust</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical Clustering">
<meta name="robots" content="noindex">
<script defer data-domain="tidyclust.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyclust</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hier_clust.html">Hierarchical Clustering</a></li>
    <li><a class="dropdown-item" href="../articles/k_means.html">k-means</a></li>
    <li><a class="dropdown-item" href="../articles/tuning_and_metrics.html">Tuning Cluster Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/tidyclust/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Hierarchical Clustering</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tidyclust/blob/main/vignettes/articles/hier_clust.Rmd" class="external-link"><code>vignettes/articles/hier_clust.Rmd</code></a></small>
      <div class="d-none name"><code>hier_clust.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span></code></pre></div>
<p>Load libraries:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/tidyclust" class="external-link">tidyclust</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'tidyclust'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:parsnip':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     knit_engine_docs, list_md_problems</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ─────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.4</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ───────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching packages</span> ───────────────────────────── tidymodels 1.3.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">broom       </span> 1.0.8     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">rsample     </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dials       </span> 1.4.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tune        </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">infer       </span> 1.0.8     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">workflowsets</span> 1.1.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">modeldata   </span> 1.4.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">yardstick   </span> 1.3.2</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">recipes     </span> 1.3.0     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ──────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">scales</span>::<span style="color: #00BB00;">discard()</span>             masks <span style="color: #0000BB;">purrr</span>::discard()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span>               masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">recipes</span>::<span style="color: #00BB00;">fixed()</span>              masks <span style="color: #0000BB;">stringr</span>::fixed()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">tidyclust</span>::<span style="color: #00BB00;">knit_engine_docs()</span> masks <span style="color: #0000BB;">parsnip</span>::knit_engine_docs()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>                  masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">tidyclust</span>::<span style="color: #00BB00;">list_md_problems()</span> masks <span style="color: #0000BB;">parsnip</span>::list_md_problems()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">yardstick</span>::<span style="color: #00BB00;">spec()</span>             masks <span style="color: #0000BB;">readr</span>::spec()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">recipes</span>::<span style="color: #00BB00;">step()</span>               masks <span style="color: #0000BB;">stats</span>::step()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">838383</span><span class="op">)</span></span></code></pre></div>
<p>Load and clean a dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"penguins"</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># shuffle rows</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If you have not yet read the <code>k_means</code> vignette, we
recommend reading that first; functions that are used in this vignette
are explained in more detail there.</p>
</div>
<div class="section level2">
<h2 id="a-brief-introduction-to-hierarchical-clustering">A brief introduction to hierarchical clustering<a class="anchor" aria-label="anchor" href="#a-brief-introduction-to-hierarchical-clustering"></a>
</h2>
<p><em>Hierarchical Clustering</em>, sometimes called <em>Agglomerative
Clustering</em>, is a method of <em>unsupervised</em> learning that
produces a <em>dendrogram</em>, which can be used to partition
observations into clusters.</p>
<p>The hierarchical clustering process begins with each observation in
it’s own cluster; i.e., <em>n</em> clusters for <em>n</em>
observations.</p>
<p><img src="hier_clust_files/figure-html/unnamed-chunk-4-1.png" alt="scatter chart. 5 circles are randomly located, and labeled a, b, c, d, and e." width="700"></p>
<p>The closest two observations are then joined together into a single
cluster.</p>
<p><img src="hier_clust_files/figure-html/unnamed-chunk-5-1.png" alt="scatter chart. 5 circles are randomly located, and labeled a, b, c, d, and e. One of the circles are replacing 2 of the previous circles." width="700"></p>
<p>This process continues, with the closest two clusters being joined
(or “agglomerated”) at each step.</p>
<p><img src="hier_clust_files/figure-html/unnamed-chunk-6-1.png" alt="scatter chart. 5 circles are randomly located, and labeled a, b, c, d, and e. One of the circles are replacing 2 of the previous circles." width="700"></p>
<p>The result of the process is a <strong>dendrogram</strong>, which
shows the joining of clusters in tree form:</p>
<pre><code><span><span class="co">#&gt; Warning in dist(fake_dat): NAs introduced by coercion</span></span></code></pre>
<p><img src="hier_clust_files/figure-html/unnamed-chunk-7-1.png" alt="Dendrogram chart. With 5 observations." width="700"></p>
<div class="section level3">
<h3 id="clusters-from-dendrogram">Clusters from dendrogram<a class="anchor" aria-label="anchor" href="#clusters-from-dendrogram"></a>
</h3>
<p>To produce a partition-style cluster assignment from the dendrogram,
one must “cut” the tree at a chosen height:</p>
<p><img src="hier_clust_files/figure-html/unnamed-chunk-8-1.png" alt="Dendrogram chart. With 5 observations. A horizontal like at 0.6 cuts the dendrogram into 3 clusters." width="700"></p>
<p>The observations that remain joined in the dendrogram below the cut
height are considered to be in a cluster together:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;   observation cluster_assignment</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> a                            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> b                            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> c                            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> d                            3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> e                            3</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="methods-of-agglomeration">Methods of agglomeration<a class="anchor" aria-label="anchor" href="#methods-of-agglomeration"></a>
</h3>
<p>At every step of the agglomeration, we measure distances between
current clusters. With each cluster containing (possibly) multiple
points, what does it mean to measure distance?</p>
<p>There are four common approaches to cluster-cluster distancing, aka
“linkage”:</p>
<ol style="list-style-type: decimal">
<li><p><strong>single linkage:</strong> The distance between two
clusters is the distance between the two <strong>closest</strong>
observations.</p></li>
<li><p><strong>average linkage:</strong> The distance between two
clusters is the average of all distances between observations in one
cluster and observations in the other.</p></li>
<li><p><strong>complete linkage:</strong> The distance between two
clusters is the distance between the two <strong>furthest</strong>
observations.</p></li>
<li><p><strong>centroid method:</strong> The distance between two
clusters is the distance between their centroids (geometric mean or
median).</p></li>
<li><p><strong>Ward’s method:</strong> The distance between two clusters
is proportional to the increase in <strong>error sum of squares
(ESS)</strong> that would result from joining them. The ESS is computed
as the sum of squared distances between observations in a cluster, and
the centroid of the cluster.</p></li>
</ol>
<p>It is also worth mentioning the <strong>McQuitty method</strong>,
which retains information about previously joined clusters to measure
future linkage distance. This method is currently supported for model
fitting, but not for prediction, in <code>tidyclust</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="hier_clust-specification-in-tidyclust">
<code>hier_clust</code> specification in {tidyclust}<a class="anchor" aria-label="anchor" href="#hier_clust-specification-in-tidyclust"></a>
</h2>
<p>To specify a hierarchical clustering model in <code>tidyclust</code>,
simply choose a value of <code>num_clusters</code> and (optionally) a
linkage method:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hier_clust.html">hier_clust</a></span><span class="op">(</span></span>
<span>  num_clusters <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  linkage_method <span class="op">=</span> <span class="st">"average"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">hc_spec</span></span>
<span><span class="co">#&gt; Hierarchical Clustering Specification (partition)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Arguments:</span></span>
<span><span class="co">#&gt;   num_clusters = 3</span></span>
<span><span class="co">#&gt;   linkage_method = average</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: stats</span></span></code></pre></div>
<p>Currently, the only supported engine is <code><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">stats::hclust()</a></code>.
The default linkage
<!-- method of this method is *complete linkage*. --></p>
<!-- Note that the hierarchical clustering algorithm does not need a number of clusters -->
<!-- specified to perform the aggomeration and produce a dendrogram, only to determine -->
<!-- a cut of the tree, so this parameter -->
<!-- does not actually need to be specified in advance. -->
<!-- ```{r} -->
<!-- hc_spec_blank <- hier_clust()  -->
<!-- hc_spec_blank -->
<!-- ``` -->
</div>
<div class="section level2">
<h2 id="fitting-hier_clust-models">Fitting <code>hier_clust</code> models<a class="anchor" aria-label="anchor" href="#fitting-hier_clust-models"></a>
</h2>
<p>We fit the model to data in the usual way:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc_fit</span> <span class="op">&lt;-</span> <span class="va">hc_spec</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="op">~</span> <span class="va">bill_length_mm</span> <span class="op">+</span> <span class="va">bill_depth_mm</span>,</span>
<span>    data <span class="op">=</span> <span class="va">penguins</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">hc_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Length Class      Mode</span></span>
<span><span class="co">#&gt; spec    4      hier_clust list</span></span>
<span><span class="co">#&gt; fit     7      hclust     list</span></span>
<span><span class="co">#&gt; elapsed 1      -none-     list</span></span>
<span><span class="co">#&gt; preproc 4      -none-     list</span></span></code></pre></div>
<p>To produce a dendrogram plot, access the engine fit: (Although as we
see below, dendrograms are often not very informative for moderate to
large size datasets.)</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc_fit</span><span class="op">$</span><span class="va">fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="hier_clust_files/figure-html/unnamed-chunk-12-1.png" alt="Dendrogram chart. With too many observations to be able to clearly see anything" width="700"></p>
<p>We can also extract the standard <code>tidyclust</code> summary
list:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc_summary</span> <span class="op">&lt;-</span> <span class="va">hc_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/extract_fit_summary.html">extract_fit_summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hc_summary</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 7</span></span>
<span><span class="co">#&gt;  $ cluster_names         : Factor w/ 3 levels "Cluster_1","Cluster_2",..: 1 2 3</span></span>
<span><span class="co">#&gt;  $ centroids             : tibble [3 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ bill_length_mm: num [1:3] 38.8 47.9 56.6</span></span>
<span><span class="co">#&gt;   ..$ bill_depth_mm : num [1:3] 18.3 16.2 16.7</span></span>
<span><span class="co">#&gt;  $ n_members             : int [1:3] 153 184 5</span></span>
<span><span class="co">#&gt;  $ sse_within_total_total: num [1:3] 378.4 573.9 9.7</span></span>
<span><span class="co">#&gt;  $ sse_total             : num 1803</span></span>
<span><span class="co">#&gt;  $ orig_labels           : NULL</span></span>
<span><span class="co">#&gt;  $ cluster_assignments   : Factor w/ 3 levels "Cluster_1","Cluster_2",..: 1 1 1 2 2 2 2 2 1 2 ...</span></span></code></pre></div>
<p>Note that, although the hierarchical clustering algorithm is not
focused on cluster centroids in the same way
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means
is, we are still able to compute the geometric mean over the predictors
for each cluster:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/extract_centroids.html">extract_centroids</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   .cluster  bill_length_mm bill_depth_mm</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Cluster_1           38.8          18.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Cluster_2           47.9          16.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Cluster_3           56.6          16.7</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h2>
<p>To predict the cluster assignment for a new observation, we find the
closest cluster. How we measure “closeness” is dependent on the
specified type of linkage in the model:</p>
<ul>
<li><p><em>single linkage</em>: The new observation is assigned to the
same cluster as its nearest observation from the training data.</p></li>
<li><p><em>complete linkage</em>: The new observation is assigned to the
cluster with the smallest maximum distances between training
observations and the new observation.</p></li>
<li><p><em>average linkage</em>: The new observation is assigned to the
cluster with the smallest average distances between training
observations and the new observation.</p></li>
<li><p><em>centroid method:</em> The new observation is assigned to the
cluster with the closest centroid, as in prediction for
<code>k_means</code>.</p></li>
<li><p><em>Ward’s method:</em> The new observation is assigned to the
cluster with the smallest increase in <strong>error sum of squares
(ESS)</strong> due to the new addition. The ESS is computed as the sum
of squared distances between observations in a cluster, and the centroid
of the cluster.</p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc_preds</span> <span class="op">&lt;-</span> <span class="va">hc_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hc_preds</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 342 × 1</span></span></span>
<span><span class="co">#&gt;    .pred_cluster</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Cluster_1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Cluster_1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Cluster_1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Cluster_2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Cluster_3    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Cluster_3    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Cluster_2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Cluster_2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Cluster_1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Cluster_2    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 332 more rows</span></span></span></code></pre></div>
<p>It’s important to note that there is no guarantee that
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> on the training data will produce the same
results as <code>extract_cluster_assignments()</code>. The process by
which clusters are created during the agglomerations results in a
particular partition; but if a training observation is treated as new
data, it is predicted in the same manner as truly new information.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span></span>
<span>  <span class="va">hc_preds</span>,</span>
<span>  <span class="fu"><a href="../reference/extract_cluster_assignment.html">extract_cluster_assignment</a></span><span class="op">(</span><span class="va">hc_fit</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 342 × 2</span></span></span>
<span><span class="co">#&gt;    .pred_cluster .cluster </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Cluster_1     Cluster_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Cluster_1     Cluster_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Cluster_1     Cluster_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Cluster_2     Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Cluster_3     Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Cluster_3     Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Cluster_2     Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Cluster_2     Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Cluster_1     Cluster_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Cluster_2     Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 332 more rows</span></span></span></code></pre></div>
<!-- Overriding cluster partition: -->
<!-- ```{r} -->
<!-- hc_fit |> extract_cluster_assignment(num_clusters = 5) -->
<!-- hc_fit |> extract_cluster_assignment(cut_height = 5) -->
<!-- ``` -->
</div>
<div class="section level2">
<h2 id="reconciling-partitions">Reconciling partitions<a class="anchor" aria-label="anchor" href="#reconciling-partitions"></a>
</h2>
<p>Suppose we have produced cluster assignments from two models: a
hierarchical clustering model with three clusters (as above) and a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means
clustering model with five clusters (below). How can we combine these
assignments?</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">km_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/k_means.html">k_means</a></span><span class="op">(</span>num_clusters <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">km_fit</span> <span class="op">&lt;-</span> <span class="va">km_spec</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">km_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">km_fit</span>, <span class="va">penguins</span>, prefix <span class="op">=</span> <span class="st">"KM_"</span><span class="op">)</span></span>
<span><span class="va">hc_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">hc_fit</span>, <span class="va">penguins</span>, prefix <span class="op">=</span> <span class="st">"HC_"</span><span class="op">)</span></span></code></pre></div>
<p>We notice that the three-cluster assignments from
<code>hier_clust</code> do not line up perfectly with the five-cluster
assignments from <code>k_means</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  hc <span class="op">=</span> <span class="va">hc_preds</span><span class="op">$</span><span class="va">.pred_cluster</span>,</span>
<span>  km <span class="op">=</span> <span class="va">km_preds</span><span class="op">$</span><span class="va">.pred_cluster</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">km</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   hc    km        n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> HC_1  KM_1     80</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> HC_1  KM_2     72</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> HC_1  KM_3      3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> HC_1  KM_5      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> HC_2  KM_3     28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> HC_2  KM_4     64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> HC_2  KM_5     76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> HC_3  KM_4     18</span></span></code></pre></div>
<p>However, they are not fully unrelated assignments. For example, all
of <code>KM_2</code> in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means
assignment fell inside <code>HC_1</code> for the hierarchical
assignments.</p>
<p>Our goal is to relabel the five
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means
clusters to match the three cluster names in the hierarchical output.
This can be accomplished with
<code><a href="../reference/reconcile_clusterings_mapping.html">reconcile_clusterings_mapping()</a></code>.</p>
<p>This function expects two vectors of cluster labels as input. The
first is the label that will be matched, and the second is the label
that will be recoded to the first.</p>
<p>If we are not trying to simply match names across two same-size
clusterings, the option <code>one_to_one</code> must be set to
<code>FALSE</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reconcile_clusterings_mapping.html">reconcile_clusterings_mapping</a></span><span class="op">(</span></span>
<span>  primary <span class="op">=</span> <span class="va">hc_preds</span><span class="op">$</span><span class="va">.pred_cluster</span>,</span>
<span>  alternative <span class="op">=</span> <span class="va">km_preds</span><span class="op">$</span><span class="va">.pred_cluster</span>,</span>
<span>  one_to_one <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 342 × 3</span></span></span>
<span><span class="co">#&gt;    primary alt   alt_recoded</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> HC_1    KM_1  HC_1       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> HC_1    KM_2  HC_1       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> HC_1    KM_2  HC_1       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> HC_2    KM_3  HC_2       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> HC_3    KM_4  HC_2       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> HC_3    KM_4  HC_2       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> HC_2    KM_3  HC_2       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> HC_2    KM_5  HC_2       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> HC_1    KM_2  HC_1       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> HC_2    KM_4  HC_2       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 332 more rows</span></span></span></code></pre></div>
<p>In this example, we can see that <code>KM_1</code>,
<code>KM_2</code>, <code>KM_5</code> have been matched to
<code>HC_1</code>; and <code>KM_3</code> and <code>KM_4</code> have been
matched to <code>HC_2</code>. Notice that no clusters from the
<code>KM</code> set were matched to <code>HC_3</code>; evidently, this
is a small cluster that did not manifest clearly in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means
clustering.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Emil Hvitfeldt, Kelly Bodwin, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
