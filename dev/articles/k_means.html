<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>k-means • tidyclust</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="k-means">
<meta name="robots" content="noindex">
<script defer data-domain="tidyclust.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyclust</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hier_clust.html">Hierarchical Clustering</a></li>
    <li><a class="dropdown-item" href="../articles/k_means.html">k-means</a></li>
    <li><a class="dropdown-item" href="../articles/tuning_and_metrics.html">Tuning Cluster Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/tidyclust/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>k-means</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tidyclust/blob/main/vignettes/articles/k_means.Rmd" class="external-link"><code>vignettes/articles/k_means.Rmd</code></a></small>
      <div class="d-none name"><code>k_means.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span></code></pre></div>
<p>Load libraries:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/tidyclust" class="external-link">tidyclust</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span></code></pre></div>
<p>Load and clean a dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"penguins"</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># shuffle rows</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>At the end of this vignette, you will find a brief overview of the
k-means algorithm, as well as some further algorithmic variant details,
for those who would like a reference.</p>
</div>
<div class="section level2">
<h2 id="k-means-specification-in-tidyclust">k-means specification in {tidyclust}<a class="anchor" aria-label="anchor" href="#k-means-specification-in-tidyclust"></a>
</h2>
<p>To specify a k-means model in <code>tidyclust</code>, simply choose a
value of <code>num_clusters</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/k_means.html">k_means</a></span><span class="op">(</span>num_clusters <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kmeans_spec</span></span>
<span><span class="co">#&gt; K Means Cluster Specification (partition)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Arguments:</span></span>
<span><span class="co">#&gt;   num_clusters = 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: stats</span></span></code></pre></div>
<p>There are currently two engines: <code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans</a></code> (default)
and <code><a href="https://rdrr.io/pkg/ClusterR/man/KMeans_rcpp.html" class="external-link">ClusterR::KMeans_rcpp</a></code>.</p>
<p>It is also possible to change the algorithmic details of the
implementation, by changing the engine and/or using the corresponding
arguments from the engine functions:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_spec_lloyd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/k_means.html">k_means</a></span><span class="op">(</span>num_clusters <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"stats"</span>, algorithm <span class="op">=</span> <span class="st">"Lloyd"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kmeans_spec_cr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/k_means.html">k_means</a></span><span class="op">(</span>num_clusters <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"ClusterR"</span>, initializer <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span></code></pre></div>
<p>Note that the <code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans</a></code> and the
<code><a href="https://rdrr.io/pkg/ClusterR/man/KMeans_rcpp.html" class="external-link">ClusterR::KMeans_rcpp</a></code> implementations have very different
default settings for the algorithmic details, so it is recommended to be
deliberate and explicit in choosing these options. (See the end of this
document for detail on the algorithmic options and defaults.)</p>
</div>
<div class="section level2">
<h2 id="fitting-k-means-models">Fitting k-means models<a class="anchor" aria-label="anchor" href="#fitting-k-means-models"></a>
</h2>
<p>Once specified, a model may be “fit” to a dataset by providing a
formula and data frame in the same manner as a <code>tidymodels</code>
model fit.<br>
Note that unlike in supervised modeling, the formula should not include
a response variable.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_fit</span> <span class="op">&lt;-</span> <span class="va">kmeans_spec</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="op">~</span> <span class="va">bill_length_mm</span> <span class="op">+</span> <span class="va">bill_depth_mm</span>,</span>
<span>    data <span class="op">=</span> <span class="va">penguins</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         Length Class   Mode</span></span>
<span><span class="co">#&gt; spec    4      k_means list</span></span>
<span><span class="co">#&gt; fit     9      kmeans  list</span></span>
<span><span class="co">#&gt; elapsed 1      -none-  list</span></span>
<span><span class="co">#&gt; preproc 4      -none-  list</span></span></code></pre></div>
<p>To access only the results produced by the engine - in this case,
<code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans</a></code> - simply extract the fit from the fitted
model object:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_fit</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; K-means clustering with 3 clusters of sizes 141, 116, 85</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cluster means:</span></span>
<span><span class="co">#&gt;   bill_length_mm bill_depth_mm</span></span>
<span><span class="co">#&gt; 2       38.40355      18.27943</span></span>
<span><span class="co">#&gt; 3       45.51379      15.64397</span></span>
<span><span class="co">#&gt; 1       50.90353      17.33647</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Clustering vector:</span></span>
<span><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17 </span></span>
<span><span class="co">#&gt;   1   1   1   2   3   3   2   2   1   3   3   1   1   1   2   1   3 </span></span>
<span><span class="co">#&gt;  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34 </span></span>
<span><span class="co">#&gt;   2   2   1   1   1   3   1   3   3   2   2   2   2   2   3   2   2 </span></span>
<span><span class="co">#&gt;  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51 </span></span>
<span><span class="co">#&gt;   2   3   3   1   2   3   2   3   2   2   2   3   1   1   1   3   1 </span></span>
<span><span class="co">#&gt;  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68 </span></span>
<span><span class="co">#&gt;   1   2   1   3   2   2   1   2   1   2   2   1   3   3   1   1   1 </span></span>
<span><span class="co">#&gt;  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85 </span></span>
<span><span class="co">#&gt;   3   3   1   1   1   1   3   2   3   1   3   1   1   1   1   3   3 </span></span>
<span><span class="co">#&gt;  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 101 102 </span></span>
<span><span class="co">#&gt;   2   1   2   3   1   1   2   1   2   3   1   1   2   2   2   2   2 </span></span>
<span><span class="co">#&gt; 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 </span></span>
<span><span class="co">#&gt;   1   1   2   1   1   2   1   2   1   1   1   2   3   2   2   3   2 </span></span>
<span><span class="co">#&gt; 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 </span></span>
<span><span class="co">#&gt;   2   1   1   1   1   3   2   1   1   2   1   3   1   1   3   1   2 </span></span>
<span><span class="co">#&gt; 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 </span></span>
<span><span class="co">#&gt;   3   2   1   1   2   2   3   2   2   2   3   3   1   3   2   1   2 </span></span>
<span><span class="co">#&gt; 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 </span></span>
<span><span class="co">#&gt;   3   3   1   3   2   1   2   1   2   1   2   3   2   2   2   1   2 </span></span>
<span><span class="co">#&gt; 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 </span></span>
<span><span class="co">#&gt;   1   2   1   1   1   2   3   3   1   2   1   1   2   2   1   2   1 </span></span>
<span><span class="co">#&gt; 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 </span></span>
<span><span class="co">#&gt;   1   2   1   2   3   3   1   1   3   1   1   2   2   1   3   2   1 </span></span>
<span><span class="co">#&gt; 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 </span></span>
<span><span class="co">#&gt;   1   1   1   2   3   3   1   1   1   2   1   3   3   1   1   1   3 </span></span>
<span><span class="co">#&gt; 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 </span></span>
<span><span class="co">#&gt;   3   1   1   2   1   1   2   3   1   1   2   3   1   1   3   1   1 </span></span>
<span><span class="co">#&gt; 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 </span></span>
<span><span class="co">#&gt;   2   3   2   2   1   3   3   3   2   1   1   3   1   1   2   3   1 </span></span>
<span><span class="co">#&gt; 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 </span></span>
<span><span class="co">#&gt;   2   2   3   1   2   3   3   2   1   3   3   2   2   1   1   2   1 </span></span>
<span><span class="co">#&gt; 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 </span></span>
<span><span class="co">#&gt;   1   1   1   1   2   1   1   3   3   3   2   1   2   1   1   1   2 </span></span>
<span><span class="co">#&gt; 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 </span></span>
<span><span class="co">#&gt;   1   2   1   1   3   2   2   2   3   2   1   3   1   1   1   3   1 </span></span>
<span><span class="co">#&gt; 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 </span></span>
<span><span class="co">#&gt;   2   2   2   1   3   2   3   3   2   1   2   2   1   3   2   2   2 </span></span>
<span><span class="co">#&gt; 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 </span></span>
<span><span class="co">#&gt;   2   3   2   2   2   3   1   3   1   2   1   3   3   3   1   3   1 </span></span>
<span><span class="co">#&gt; 341 342 </span></span>
<span><span class="co">#&gt;   2   2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Within cluster sum of squares by cluster:</span></span>
<span><span class="co">#&gt; [1] 944.4986 754.7437 617.9859</span></span>
<span><span class="co">#&gt;  (between_SS / total_SS =  79.8 %)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Available components:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "cluster"      "centers"      "totss"        "withinss"    </span></span>
<span><span class="co">#&gt; [5] "tot.withinss" "betweenss"    "size"         "iter"        </span></span>
<span><span class="co">#&gt; [9] "ifault"</span></span></code></pre></div>
<p><code>tidyclust</code> also provides a function,
<code><a href="../reference/extract_fit_summary.html">extract_fit_summary()</a></code>, to produce a list of model summary
information in a format that is consistent across all cluster model
specifications and engines</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_summary</span> <span class="op">&lt;-</span> <span class="va">kmeans_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_fit_summary.html">extract_fit_summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kmeans_summary</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 7</span></span>
<span><span class="co">#&gt;  $ cluster_names         : Factor w/ 3 levels "Cluster_1","Cluster_2",..: 1 2 3</span></span>
<span><span class="co">#&gt;  $ centroids             : tibble [3 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ bill_length_mm: num [1:3] 38.4 45.5 50.9</span></span>
<span><span class="co">#&gt;   ..$ bill_depth_mm : num [1:3] 18.3 15.6 17.3</span></span>
<span><span class="co">#&gt;  $ n_members             : int [1:3] 141 116 85</span></span>
<span><span class="co">#&gt;  $ sse_within_total_total: num [1:3] 944 755 618</span></span>
<span><span class="co">#&gt;  $ sse_total             : num 11494</span></span>
<span><span class="co">#&gt;  $ orig_labels           : int [1:342] 1 1 1 2 3 3 2 2 1 3 ...</span></span>
<span><span class="co">#&gt;  $ cluster_assignments   : Factor w/ 3 levels "Cluster_1","Cluster_2",..: 1 1 1 2 3 3 2 2 1 3 ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cluster-assignments-and-centers">Cluster assignments and centers<a class="anchor" aria-label="anchor" href="#cluster-assignments-and-centers"></a>
</h2>
<p>The primary objective of fitting a clustering model is typically to
assign observations to clusters. To access these, use
<code><a href="../reference/extract_cluster_assignment.html">extract_cluster_assignment()</a></code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_cluster_assignment.html">extract_cluster_assignment</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 342 × 1</span></span></span>
<span><span class="co">#&gt;    .cluster </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Cluster_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Cluster_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Cluster_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Cluster_3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Cluster_3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Cluster_2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Cluster_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Cluster_3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 332 more rows</span></span></span></code></pre></div>
<p>Note that this function renames clusters in accordance with the
standard <code>tidyclust</code> naming convention and ordering: clusters
are named “Cluster_1”, “Cluster_2”, etc. and are numbered by the order
they appear in the rows of the training dataset.</p>
<p>To reconcile these standardized cluster labels with the engine
output, refer back to the full model fit summary:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  orig_labels <span class="op">=</span> <span class="va">kmeans_summary</span><span class="op">$</span><span class="va">orig_labels</span>,</span>
<span>  standard_labels <span class="op">=</span> <span class="va">kmeans_summary</span><span class="op">$</span><span class="va">cluster_assignments</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 342 × 2</span></span></span>
<span><span class="co">#&gt;    orig_labels standard_labels</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>           1 Cluster_1      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>           1 Cluster_1      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>           1 Cluster_1      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           2 Cluster_2      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           3 Cluster_3      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>           3 Cluster_3      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>           2 Cluster_2      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>           2 Cluster_2      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>           1 Cluster_1      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>           3 Cluster_3      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 332 more rows</span></span></span></code></pre></div>
<p>In this example, we see that the cluster labelled “3” by the
<code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans</a></code> engine function - a label that is assigned
randomly by this implementation - is the first to appear in the training
data, so it is converted to “Cluster_1” in the standardized labels.</p>
<div class="section level3">
<h3 id="centroids">Centroids<a class="anchor" aria-label="anchor" href="#centroids"></a>
</h3>
<p>A secondary output of interest is often the characterization of the
clusters; i.e., what data feature trends does each cluster seem to
represent? Most commonly, clusters are characterized by their mean
values in the predictor space, a.k.a. the centroids.</p>
<p>These can be accessed from the full summary:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_summary</span><span class="op">$</span><span class="va">centroids</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   bill_length_mm bill_depth_mm</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>           38.4          18.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>           45.5          15.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>           50.9          17.3</span></span></code></pre></div>
<p>They can also be accessed directly from the fitted model with:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_centroids.html">extract_centroids</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   .cluster  bill_length_mm bill_depth_mm</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Cluster_1           38.4          18.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Cluster_2           45.5          15.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Cluster_3           50.9          17.3</span></span></code></pre></div>
<p>Based on the above output, we might say that Cluster_1 is penguins
with smaller bill lengths, Cluster_2 has smaller bill depths, and
Cluster_3 is penguins with large bills in both dimensions.</p>
</div>
</div>
<div class="section level2">
<h2 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h2>
<!-- Since unsupervised methods are not designed for prediction, the notion of  -->
<!-- predicting the cluster assignment is not always obvious. -->
<p>Since the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means
algorithm ultimately assigns training observations to the cluster with
the closest centroid, it is natural to “predict” that test observations
also belong to the closest centroid cluster.</p>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function behaves as expected, producing
cluster assignment predictions on new data based on distance to the
fitted model centroids.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_penguin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  bill_length_mm <span class="op">=</span> <span class="fl">42</span>,</span>
<span>  bill_depth_mm <span class="op">=</span> <span class="fl">17</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">new_penguin</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   .pred_cluster</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Cluster_2</span></span></code></pre></div>
<!-- It is possible to tweak the prediction process by using a different distance -->
<!-- metric to measure closest centroid.  This is not recommended unless the original -->
<!-- model fit also used an alternate distance function in the $k$-means algorithm. -->
<!-- ```{r} -->
<!-- kmeans_fit |> -->
<!--   predict(new_penguin, -->
<!--           dist_fun = dist(., method = "manhattan")) -->
<!-- ``` -->
<p>To attach all predictions to a dataset as a column, use
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 342 × 3</span></span></span>
<span><span class="co">#&gt;    bill_length_mm bill_depth_mm .pred_cluster</span></span>
<span><span class="co">#&gt;             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>           39.6          20.7 Cluster_1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>           36.2          17.3 Cluster_1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>           32.1          15.5 Cluster_1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           47.6          18.3 Cluster_2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           52            18.1 Cluster_3    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>           52.7          19.8 Cluster_3    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>           45.2          16.4 Cluster_2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>           46.6          14.2 Cluster_2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>           34.4          18.4 Cluster_1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>           49.8          15.9 Cluster_3    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 332 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metrics">Metrics<a class="anchor" aria-label="anchor" href="#metrics"></a>
</h2>
<p>Since clustering is an unsupervised method, with no target/outcome
variable, there is no objective notion of predictive success.</p>
<p>However, many common approaches exist for quantifying the quality of
a particular cluster partition or structure.</p>
<div class="section level3">
<h3 id="sum-of-squared-error">Sum of squared error<a class="anchor" aria-label="anchor" href="#sum-of-squared-error"></a>
</h3>
<p>One simple metric is the <strong>within cluster sum-of-squared error
(WSS)</strong>, which measures the sum of all distances from
observations to their cluster center. This is sometimes scaled with the
<strong>total sum-of-squared error (TSS)</strong>, the distance from all
observations to the global centroid; in particular, the ratio
<strong>WSS/TSS</strong> is often computed. In principle, small values
of WSS or of the WSS/TSS ratio suggest that the observations within
clusters are closer (more similar) to each other than they are to the
other clusters.</p>
<p>The WSS and TSS come “for free” with the model fit summary, or they
can be accessed directly from the model fit:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_summary</span><span class="op">$</span><span class="va">sse_within_total_total</span></span>
<span><span class="co">#&gt; [1] 944.4986 754.7437 617.9859</span></span>
<span><span class="va">kmeans_summary</span><span class="op">$</span><span class="va">sse_total</span></span>
<span><span class="co">#&gt; [1] 11494.04</span></span>
<span></span>
<span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/sse_within_total.html">sse_within_total</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric          .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> sse_within_total standard       <span style="text-decoration: underline;">2</span>317.</span></span>
<span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/sse_total.html">sse_total</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric   .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> sse_total standard      <span style="text-decoration: underline;">11</span>494.</span></span>
<span></span>
<span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/sse_ratio.html">sse_ratio</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric   .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> sse_ratio standard       0.202</span></span></code></pre></div>
<p>We can also see the within sum-of-squares by cluster, rather than
totalled, with <code><a href="../reference/sse_within.html">sse_within()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/sse_within.html">sse_within</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   .cluster    wss n_members</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Cluster_1  944.       141</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Cluster_2  755.       116</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Cluster_3  618.        85</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="silhouette">Silhouette<a class="anchor" aria-label="anchor" href="#silhouette"></a>
</h3>
<p>Another common measure of cluster structure is called the
<strong>silhouette</strong>. The silhouette of a single observation is
proportional to the average distance from that observation to
within-cluster observations minus the average distance to
outside-cluster observations; normalized by the greater of these two
average.<br>
In principle, a large silhouette (close to 1) suggests that an
observation is more similar to those within its cluster than those
outside its cluster.</p>
<p>We can average all silhouettes to get a metric for the full
clustering fit. Beause the computation of the silhouette depends on the
original observation values, a dataset must also be supplied to the
function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/silhouette_avg.html">silhouette_avg</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric        .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> silhouette_avg standard       0.488</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="changing-distance-measures">Changing distance measures<a class="anchor" aria-label="anchor" href="#changing-distance-measures"></a>
</h3>
<p>These metrics all depend on measuring the distance between points
and/or centroids. By default, ordinary Euclidean distance is used.
However, it is possible to select a different distance function.</p>
<p>For sum of squares metrics, the distance function supplied must take
two arguments (i.e., the observation locations and the centroid
locations). For the sihouette metric, the distance function must find
pairwise distances from a single matrix (i.e., all pairwise distances
between observations).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_dist_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">philentropy</span><span class="fu">::</span><span class="fu"><a href="https://drostlab.github.io/philentropy/reference/distance.html" class="external-link">distance</a></span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"manhattan"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_dist_2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">philentropy</span><span class="fu">::</span><span class="fu"><a href="https://drostlab.github.io/philentropy/reference/dist_many_many.html" class="external-link">dist_many_many</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, method <span class="op">=</span> <span class="st">"manhattan"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/sse_ratio.html">sse_ratio</a></span><span class="op">(</span>dist_fun <span class="op">=</span> <span class="va">my_dist_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric   .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> sse_ratio standard       0.202</span></span>
<span></span>
<span><span class="va">kmeans_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/silhouette_avg.html">silhouette_avg</a></span><span class="op">(</span><span class="va">penguins</span>, dist_fun <span class="op">=</span> <span class="va">my_dist_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric        .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> silhouette_avg standard       0.494</span></span></code></pre></div>
<p>For more on using metrics for cluster model selection, see the Tuning
vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="workflows">Workflows<a class="anchor" aria-label="anchor" href="#workflows"></a>
</h2>
<p>The workflow structure of <code>tidymodels</code> is also usable with
<code>tidyclust</code> objects. In the following example, we try two
recipes for clustering penguins by bill dimensions. In the second
recipe, we log-scale both predictors before clustering.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins_recipe_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="op">~</span> <span class="va">bill_length_mm</span> <span class="op">+</span> <span class="va">bill_depth_mm</span>,</span>
<span>  data <span class="op">=</span> <span class="va">penguins</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">penguins_recipe_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="op">~</span> <span class="va">bill_length_mm</span> <span class="op">+</span> <span class="va">bill_depth_mm</span>,</span>
<span>  data <span class="op">=</span> <span class="va">penguins</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_numeric_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wflow_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_model.html" class="external-link">add_model</a></span><span class="op">(</span><span class="va">kmeans_spec</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_recipe.html" class="external-link">add_recipe</a></span><span class="op">(</span><span class="va">penguins_recipe_1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wflow_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_model.html" class="external-link">add_model</a></span><span class="op">(</span><span class="va">kmeans_spec</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_recipe.html" class="external-link">add_recipe</a></span><span class="op">(</span><span class="va">penguins_recipe_2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wflow_1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_centroids.html">extract_centroids</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   .cluster  bill_length_mm bill_depth_mm</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Cluster_1           38.4          18.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Cluster_2           45.5          15.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Cluster_3           50.9          17.3</span></span>
<span></span>
<span><span class="va">wflow_2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_centroids.html">extract_centroids</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   .cluster  bill_length_mm bill_depth_mm</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Cluster_1           3.65          2.90</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Cluster_2           3.90          2.92</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Cluster_3           3.85          2.70</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-brief-introduction-to-the-k-means-algorithm">A brief introduction to the k-means algorithm<a class="anchor" aria-label="anchor" href="#a-brief-introduction-to-the-k-means-algorithm"></a>
</h2>
<p><em>k-means</em> is a method of <em>unsupervised</em> learning that
produces a partitioning of observations into <em>k</em> unique clusters.
The goal of <em>k-means</em> is to minimize the sum of squared Euclidian
distances between observations in a cluster and the
<strong>centroid</strong>, or geometric mean, of that cluster.</p>
<p>In <em>k-means</em> clustering, observed variables (columns) are
considered to be locations on axes in multidimensional space. For
example, in the plot below, each point represents an observation of one
penguin, and the location in 2-dimensional space is determined by the
bill length and bill depth of that penguin.</p>
<p><img src="k_means_files/figure-html/unnamed-chunk-21-1.png" alt="scatter chart. bill_length_mm along the x-axis, bill_depth_mm along the y-axis. 3 vague cluster appears in the point cloud." width="700"></p>
<p>A <em>k-means</em> cluster assignment is achieved by iterating to
convergence from random initial conditions. The algorithm typically
proceeds as follows:</p>
<ol style="list-style-type: decimal">
<li>Choose <em>k</em> random observations in the dataset. These
locations in space are declared to be the <strong>initial
centroids</strong>.</li>
</ol>
<p><img src="k_means_files/figure-html/unnamed-chunk-22-1.png" alt="scatter chart. bill_length_mm along the x-axis, bill_depth_mm along the y-axis. 3 vague cluster appears in the point cloud. 3 random points have been highlighted red, green, and blue." width="700"></p>
<ol start="2" style="list-style-type: decimal">
<li>Assign each observation to the nearest centroid.</li>
</ol>
<p><img src="k_means_files/figure-html/unnamed-chunk-23-1.png" alt="scatter chart. bill_length_mm along the x-axis, bill_depth_mm along the y-axis. 3 vague cluster appears in the point cloud. Point are colored according to how close they were to the color points." width="700"></p>
<ol start="3" style="list-style-type: decimal">
<li>Compute the new centroids of each cluster.</li>
</ol>
<p><img src="k_means_files/figure-html/unnamed-chunk-24-1.png" alt="scatter chart. bill_length_mm along the x-axis, bill_depth_mm along the y-axis. 3 vague cluster appears in the point cloud. New highlights are placed in the center of the points of the same color in the previous chart." width="700"></p>
<ol start="4" style="list-style-type: decimal">
<li>Repeat steps 2 and 3 until the centroids do not change.</li>
</ol>
<p><img src="k_means_files/figure-html/unnamed-chunk-25-1.png" alt="scatter chart. bill_length_mm along the x-axis, bill_depth_mm along the y-axis. 3 vague cluster appears in the point cloud. All points have been colored of the 3 colors, with an ellipse acound each color." width="700"></p>
<div class="section level3">
<h3 id="iteration-of-centroids">Iteration of centroids<a class="anchor" aria-label="anchor" href="#iteration-of-centroids"></a>
</h3>
<p>There is also some variation between implementations on how the
update process takes place.</p>
<p>In the above example, we have shown the common implementation known
as the <code>Lloyd</code> or the <code>Forgy</code> method. The update
steps are:</p>
<ol style="list-style-type: decimal">
<li>Assign <strong>all</strong> observations to closest centroid.</li>
<li>Recalculate centroids.</li>
<li>Repeat until convergence.</li>
</ol>
<p>One variant on this approach is the <code>MacQueen</code> method,
which updates centroids continually:</p>
<ol style="list-style-type: decimal">
<li>Assign <strong>one</strong> observation to closest centroid.</li>
<li>Recalculate centroids.</li>
<li>Repeat until all observations have been reassigned once.</li>
<li>Repeat until convergence.</li>
</ol>
<p>A third common variant is the <code>Hartigan-Wong</code> method,
which assigns observations based on overall sum of squared errors rather
than simply to the closest cluster:</p>
<ol style="list-style-type: decimal">
<li>Temporarily assign <strong>one</strong> observation to
<strong>one</strong> cluster.</li>
<li>Recalculate centroid.</li>
<li>Find <strong>all</strong> distances from observations to their
cluster center (SSE).</li>
<li>Repeat for <strong>each</strong> cluster.</li>
<li>Permanently assign the observation to the cluster that resulted in
the lowest SSE.</li>
<li>Repeat for all observations.</li>
<li>Repeat until convergence.</li>
</ol>
<p>As with many interactive algorithms, the choice between methods is a
choice of complexity versus accuracy. The <code>Hartigan-Wong</code>
method generally results in more consistent and human-verified
clusterings, and it is the default setting for the
<code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans</a></code> implementation of k-means clustering;
although all three algorithms are available as options in this engine.
The <code>Lloyd/Forgy</code> method is the most simple and ubiquitous;
this is the only method available in the <code>ClusterR</code> package
implementation.</p>
<p><a href="https://towardsdatascience.com/three-versions-of-k-means-cf939b65f4ea" class="external-link">Source</a></p>
</div>
<div class="section level3">
<h3 id="initialization-of-the-k-means-algorithm">Initialization of the k-means algorithm<a class="anchor" aria-label="anchor" href="#initialization-of-the-k-means-algorithm"></a>
</h3>
<p>The <em>k-means</em> algorithm depends on choosing an initial set of
cluster centers.</p>
<p>There are three common methods for selecting initial centers:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Random observations:</strong> In the example above, we
have chosen three random observations to act as our initial centers.
This is the most commonly used approach, implemented in the
<code>Forgy</code>, <code>Lloyd</code>, and <code>MacQueen</code>
methods.</p></li>
<li><p><strong>Random partition:</strong> The observations are assigned
to a cluster uniformly at random. The centroid of each cluster is
computed, and these are used as the initial centers. This approach is
implemented in the <code>Hartigan-Wong</code> method.</p></li>
<li><p><strong>k-means++:</strong> Beginning with one random set of the
observations, further observations are sampled via probability-weighted
sampling until
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
clusters are formed. The centroids of these clusters are used as the
initial centers. (<a href="https://en.wikipedia.org/wiki/K-means%2B%2B" class="external-link">Further detail
here</a>)</p></li>
</ol>
<p>Because the initial conditions are based on random selection in both
approaches, the k-means algorithm is not determinitistic. That is,
running the clustering twice on the same data may not result in the same
cluster assignments.</p>
<p>It is common to perform the k-means clustering algorithm multiple
times, with different random initial conditions, and combine results at
the end. This option is controlled by the <code>nstart</code> argument
of the <code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans</a></code> implementation, and the
<code>num_init</code> argument of the <code><a href="https://rdrr.io/pkg/ClusterR/man/KMeans_rcpp.html" class="external-link">ClusterR::KMeans_rcpp</a></code>
implementation.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Emil Hvitfeldt, Kelly Bodwin, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
